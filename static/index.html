<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="title">Экспрессо</title>
    <link rel="shortcut icon" href="data:image/png;base64,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" type="image/png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>

    <style>
        @import url('https://fonts.googleapis.com/css?family=Pacifico&display=swap&subset=cyrillic');

        body {
            margin: 0;

            font-family: Roboto, sans-serif;
        }

        header {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 200px;
            background-color: #6eeb43;
        }

        h1 {
            font-family: 'Pacifico', cursive;
            margin: 0;
            padding: 0;
            font-weight: normal;
            font-size: 69px;
            color: white;
            text-shadow: 0 0 10px #00000008;
            margin-bottom: 20px;
            user-select: none;
            cursor: pointer;
        }

        main {
            width: calc(100% - 20px);
            max-width: 900px;
            margin: 0 auto;
            margin-top: -21px;
        }

        #input-container {
            position: relative;
        }

        #expression-inpt {
            width: 100%;
            max-width: calc(100% - 15px*2);
            outline: none;
            font-size: 20px;
            line-height: 30px;
            padding: 5px 15px;
            border: 1px solid #8c8c8c;
            border-radius: 21px;
        }

        #expression-inpt:focus {
            box-shadow: 0 0 10px #00000026;
        }

        #enter-label {
            position: absolute;
            right: 5px;
            top: calc(50% - 14px);
        }

        #enter-label>path {
            fill-opacity: 0;
            transition: fill-opacity 0.2s ease;
        }

        #enter-label.enter-tip>path {
            fill-opacity: 1;
        }

        #error {
            border: 1px solid red;
            color: red;
            margin-top: 20px;
            padding: 10px 10px;
            border-radius: 3px;
        }
        #error.hidden {
            display: none;
        }

        #solution {
            border: 1px solid #6deb43;
            margin-top: 20px;
            padding: 5px 10px;
            border-radius: 3px;
        }

        #solution:empty {
            display: none;
        }


        #steps {
            margin-top: 30px;
        }

        .step {
            margin-bottom: 30px;
        }

        .step-show {
            display: flex;
            align-items: center;
            
        }

        .step-show-id {
            width: 100px;
            font-size: 16px;
            color: #a2a2a2;
            text-align: center;
            margin-bottom: 5px;
        }

        .step-desc-p {
            margin: 0 0 0 100px;
            font-size: 18px;
            margin-bottom: 10px;
        }

        @media screen and (max-width: 550px) {
            .step-show-id {
                width: 45px;
                padding-left: 5px;
                text-align: left;
            }

            .step-desc-p {
                margin-left: 50px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div>
            <h1 id="logo">Экспрессо</h1>
        </div>
    </header>
    <main>
        <div id="input-container">
            <svg
                id="enter-label"
                xmlns="http://www.w3.org/2000/svg"
                height="28"
                width="28"
                viewBox="0 0 24 24"
            >
                <path fill="#b5b5b5" d="M19 8v3H5.83l2.88-2.88c.39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0L2.71 11.3c-.39.39-.39 1.02 0 1.41L7.3 17.3c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L5.83 13H20c.55 0 1-.45 1-1V8c0-.55-.45-1-1-1s-1 .45-1 1z"/>
            </svg>
            <input id="expression-inpt" autofocus type="text" placeholder="Введите выражение">
        </div>
        <div id="error" class="hidden">
            Ваш запрос не был распознан, проверьте корректность выражения
        </div>
        <div id="solution"></div>
        <div id="steps">

        </div>
    </main>

    <script>
        class App {
            constructor() {
                // bind methods
                this.onKeyPress = this.onKeyPress.bind(this)
                this.onInput = this.onInput.bind(this)
                this.displayError = this.displayError.bind(this)
                this.hideError = this.hideError.bind(this)
                this.clearState = this.clearState.bind(this)
                this.express = this.express.bind(this)

                // get elements
                this.logo       = document.getElementById('logo')
                this.title      = document.getElementById('title')
                this.inpt       = document.getElementById('expression-inpt')
                this.stepsEl    = document.getElementById('steps')
                this.solutionEl = document.getElementById('solution')
                this.errorEl    = document.getElementById('error')
                this.enterLabel = document.getElementById('enter-label')

                // set listeners
                this.inpt.addEventListener('keypress', this.onKeyPress)
                this.inpt.addEventListener('input', this.onInput)
                this.logo.addEventListener('click', this.clearState)

                // load callback
                window.addEventListener("load", () => {
                    const urlParams = new URLSearchParams(window.location.search)
                    const expressionEncoded = urlParams.get('e')

                    if(expressionEncoded !== null) {
                        const expression = decodeURIComponent(expressionEncoded)
                        this.title.innerText = `${expression} — Экспрессо`

                        this.inpt.value = expression

                        this.express(expression)
                    }
                })
            }

            onKeyPress(e) {
                const expr = this.inpt.value.trim()

                if(e.key !== 'Enter') {
                    return
                }

                window.history.pushState(null, null, `/expresso?e=${encodeURIComponent(expr)}`)
                this.title.innerText = `${expr} — Экспрессо`

                this.enterLabel.classList.remove('enter-tip')
                this.hideError()

                this.express(expr)
            }

            onInput(e) {
                const expr = this.inpt.value.trim()

                if(expr.length === 0) {
                    this.enterLabel.classList.remove('enter-tip')
                } else {
                    this.enterLabel.classList.add('enter-tip')
                }
            }

            displayError() {
                this.errorEl.classList.remove('hidden')
            }

            hideError() {
                this.errorEl.classList.add('hidden')
            }

            clearState() {
                window.location.href = '/'
            }

            async express(expr) {
                const resp = await fetch(`/expresso/steps?e=${ encodeURIComponent(expr)}`)
                const steps = await resp.json()

                if(steps.error) {
                    this.displayError()
                    return
                }

                const solutionCode = steps.length === 1 ?
                    steps[0].expression : `${steps[0].expression} = ${steps[steps.length - 1].expression}`

                const solutionHtml = katex.renderToString(
                    solutionCode,
                    {
                        throwOnError: false,
                        maxSize: Infinity,
                        displayMode: true
                    }
                )

                this.solutionEl.innerHTML = solutionHtml

                const stepsHtml = steps.map(step => `
                    <div class="step">
                        <div class="step-desc">
                            <p class="step-desc-p">${step.comment}:</p>
                        </div>
                        <div class="step-show">
                            <div class="step-show-id">(${step.step})</div>  
                            <div class="step-show-content">${
                                katex.renderToString(step.expression, {
                                    throwOnError: false,
                                    maxSize: Infinity,
                                    displayMode: true
                                })
                            }</div>   
                        </div>
                    </div>
                `).join('\n')

                this.stepsEl.innerHTML = stepsHtml
            }
        }

        const app = new App()
    </script>
</body>
</html>